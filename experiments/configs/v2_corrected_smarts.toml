# REINVENT4 骨架约束生成 - PI确认版本
# 基于PI确认的精确骨架定义

run_type = "staged_learning"
device = "cuda:0"
tb_logdir = "tb_scaffold_pi_confirmed"
json_out_config = "_scaffold_pi_confirmed.json"

[parameters]
summary_csv_prefix = "scaffold_pi_confirmed_results"
use_checkpoint = false
prior_file = "priors/denv_ultra_clean_model.model"
agent_file = "priors/denv_ultra_clean_model.model"
batch_size = 64
unique_sequences = true
randomize_smiles = true

[learning_strategy]
type = "dap"
sigma = 120
rate = 0.0001

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = 20
minscore = 0.30
minsimilarity = 0.4

[inception]
smiles_file = "data/denv_scaffolds_training.smi"
memory_size = 100
sample_size = 10

[[stage]]
max_score = 0.65
min_steps = 500
max_steps = 2000
chkpt_file = "scaffold_pi_confirmed.chkpt"

#═══════════════════════════════════════════════════════════
# 关键改动：使用 arithmetic_mean（OR逻辑）
# 满足任意一个骨架即可得分
#═══════════════════════════════════════════════════════════
[stage.scoring]
type = "arithmetic_mean"

#═══════════════════════════════════════════════════════════
# 骨架1：吡咯烷型（PI确认的精确定义）
# 特征：5元含N环，C3位酰胺，C2位苯环，NH仲胺
#═══════════════════════════════════════════════════════════
[[stage.scoring.component]]
[stage.scoring.component.MatchingSubstructure]
[[stage.scoring.component.MatchingSubstructure.endpoint]]
name = "Pyrrolidine_Scaffold"
weight = 1.0

[stage.scoring.component.MatchingSubstructure.endpoint.params]
# SMARTS: 5元环 C1-NH-C(苯环)-C(酰胺)-C1
smarts = "C1NC(c2ccccc2)C(C(=O)N)C1"
use_chirality = false

#═══════════════════════════════════════════════════════════
# 骨架2：环丁烷型（PI确认的精确定义）
# 特征：4元全碳环，C1位酰胺，C2位苯环
#═══════════════════════════════════════════════════════════
[[stage.scoring.component]]
[stage.scoring.component.MatchingSubstructure]
[[stage.scoring.component.MatchingSubstructure.endpoint]]
name = "Cyclobutane_Scaffold"
weight = 1.0

[stage.scoring.component.MatchingSubstructure.endpoint.params]
# SMARTS: 4元环 C1-C(苯环)-C-C1(酰胺)
smarts = "C1C(c2ccccc2)CC1C(=O)N"
use_chirality = false

#═══════════════════════════════════════════════════════════
# 活性预测 - 提高权重
#═══════════════════════════════════════════════════════════
[[stage.scoring.component]]
[stage.scoring.component.QSARScorer]
[[stage.scoring.component.QSARScorer.endpoint]]
name = "DENV_Activity"
weight = 1.5

[stage.scoring.component.QSARScorer.endpoint.params]
model_path = "/mnt/c/Users/ucsaheu/python_projects/DENV_Drug_Discovery/02_ML_Modeling/models/random_forest_champion.joblib"

[stage.scoring.component.QSARScorer.endpoint.transform]
type = "double_sigmoid"
low = 6.5
high = 8.5
coef_div = 8.5
coef_si = 4.0
coef_se = 4.0

#═══════════════════════════════════════════════════════════
# 类药性
#═══════════════════════════════════════════════════════════
[[stage.scoring.component]]
[stage.scoring.component.Qed]
[[stage.scoring.component.Qed.endpoint]]
name = "Drug_Likeness"
weight = 0.5

#═══════════════════════════════════════════════════════════
# 合成可及性
#═══════════════════════════════════════════════════════════
[[stage.scoring.component]]
[stage.scoring.component.SAScore]
[[stage.scoring.component.SAScore.endpoint]]
name = "Synthetic_Accessibility"
weight = 0.4

[stage.scoring.component.SAScore.endpoint.transform]
type = "reverse_sigmoid"
low = 1.0
high = 8.0
k = 0.5

#═══════════════════════════════════════════════════════════
# 分子量
#═══════════════════════════════════════════════════════════
[[stage.scoring.component]]
[stage.scoring.component.MolecularWeight]
[[stage.scoring.component.MolecularWeight.endpoint]]
name = "Molecular_Weight"
weight = 0.3

[stage.scoring.component.MolecularWeight.endpoint.transform]
type = "double_sigmoid"
low = 250.0
high = 500.0
coef_div = 500.0
coef_si = 15.0
coef_se = 15.0

#═══════════════════════════════════════════════