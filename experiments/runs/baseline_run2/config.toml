# REINVENT4 LibInvent - Baseline Configuration
# Generated at 2025-12-02 11:10:02
# 
# 参数理论依据:
#   batch_size=64: 减少CPU SMILES处理瓶颈，提高GPU利用率
#   sigma=200: DAP公式 augmented_nlls = agent_nlls + sigma*(1-scores)
#              更高sigma增强探索，防止早熟收敛
#   rate=0.0002: 与较小batch配合，保持稳定的有效学习率
#   bucket_size=20: 每个Murcko scaffold允许20个变体后才惩罚

run_type = "staged_learning"
device = "cuda:0"
tb_logdir = "experiments/runs/baseline_run2/tensorboard"
json_out_config = "experiments/runs/baseline_run2/_config.json"

[parameters]
summary_csv_prefix = "experiments/runs/baseline_run2/results"
use_checkpoint = true
purge_memories = false

prior_file = "experiments/runs/baseline_run2/checkpoint.chkpt"
agent_file = "priors/denv_libinvent_model_v2.model"
smiles_file = "data/pyrrolidine_dual_aryl.smi"

# ============================================
# 优化参数 - 针对DGX Spark
# ============================================
batch_size = 64
unique_sequences = true
randomize_smiles = false

[learning_strategy]
type = "dap"
sigma = 200
rate = 0.0002

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = 20
minscore = 0.4

[inception]
smiles_file = "data/pyrrolidine_dual_aryl.smi"
memory_size = 50
sample_size = 10

# ============================================
# Stage 1: 主训练阶段
# ============================================
[[stage]]
max_score = 0.85
min_steps = 500
max_steps = 1000
chkpt_file = "experiments/runs/baseline_run2/checkpoint.chkpt"

[stage.scoring]
type = "arithmetic_mean"

# ========================================
# 第一优先级：QSAR活性预测 (权重3.0)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.QSARScorer]
[[stage.scoring.component.QSARScorer.endpoint]]
name = "DENV_Activity"
weight = 3.0

[stage.scoring.component.QSARScorer.endpoint.params]
model_path = "models/random_forest_champion.joblib"

[stage.scoring.component.QSARScorer.endpoint.transform]
type = "double_sigmoid"
low = 4.5
high = 9.0
coef_div = 9.0
coef_si = 8.0
coef_se = 8.0

# ========================================
# 第二优先级：化学稳定性
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.NumAtomStereoCenters]
[[stage.scoring.component.NumAtomStereoCenters.endpoint]]
name = "Stereo_Centers"
weight = 0.6

[stage.scoring.component.NumAtomStereoCenters.endpoint.transform]
type = "reverse_sigmoid"
low = 0
high = 3
k = 1.0

[[stage.scoring.component]]
[stage.scoring.component.CustomAlerts]
[[stage.scoring.component.CustomAlerts.endpoint]]
name = "Stability_Alerts"
weight = 1.2

[stage.scoring.component.CustomAlerts.endpoint.params]
smarts = [
    "[*;r8]", "[*;r9]", "[*;r10]",
    "[#8][#8]",
    "[#6;+]",
    "C#C",
    "[NX3][NX3]",
    "[SH]",
    "[N+](=O)[O-]",
    "S(=O)(=O)Cl",
    "[F,Cl,Br,I][C,c][F,Cl,Br,I]",
]

# ========================================
# 第三优先级：类药性
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.Qed]
[[stage.scoring.component.Qed.endpoint]]
name = "QED"
weight = 0.4

[[stage.scoring.component]]
[stage.scoring.component.SAScore]
[[stage.scoring.component.SAScore.endpoint]]
name = "SA"
weight = 0.5

[stage.scoring.component.SAScore.endpoint.transform]
type = "reverse_sigmoid"
low = 1.0
high = 5.5
k = 0.8

# ========================================
# 第四优先级：物理化学性质
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.MolecularWeight]
[[stage.scoring.component.MolecularWeight.endpoint]]
name = "MW"
weight = 0.5

[stage.scoring.component.MolecularWeight.endpoint.transform]
type = "double_sigmoid"
low = 280.0
high = 550.0
coef_div = 550.0
coef_si = 15.0
coef_se = 15.0

[[stage.scoring.component]]
[stage.scoring.component.SlogP]
[[stage.scoring.component.SlogP.endpoint]]
name = "LogP"
weight = 0.4

[stage.scoring.component.SlogP.endpoint.transform]
type = "double_sigmoid"
low = 1.0
high = 4.5
coef_div = 4.5
coef_si = 10.0
coef_se = 10.0

[[stage.scoring.component]]
[stage.scoring.component.TPSA]
[[stage.scoring.component.TPSA.endpoint]]
name = "TPSA"
weight = 0.3

[stage.scoring.component.TPSA.endpoint.transform]
type = "double_sigmoid"
low = 40.0
high = 120.0
coef_div = 120.0
coef_si = 15.0
coef_se = 15.0

[[stage.scoring.component]]
[stage.scoring.component.HBondAcceptors]
[[stage.scoring.component.HBondAcceptors.endpoint]]
name = "HBA"
weight = 0.3

[stage.scoring.component.HBondAcceptors.endpoint.transform]
type = "reverse_sigmoid"
low = 2
high = 8
k = 0.5

[[stage.scoring.component]]
[stage.scoring.component.HBondDonors]
[[stage.scoring.component.HBondDonors.endpoint]]
name = "HBD"
weight = 0.2

[stage.scoring.component.HBondDonors.endpoint.transform]
type = "reverse_sigmoid"
low = 0
high = 4
k = 0.5

[[stage.scoring.component]]
[stage.scoring.component.NumRotBond]
[[stage.scoring.component.NumRotBond.endpoint]]
name = "Rotatable_Bonds"
weight = 0.2

[stage.scoring.component.NumRotBond.endpoint.transform]
type = "reverse_sigmoid"
low = 0
high = 8
k = 0.5

[[stage.scoring.component]]
[stage.scoring.component.NumRings]
[[stage.scoring.component.NumRings.endpoint]]
name = "Ring_Count"
weight = 0.2

[stage.scoring.component.NumRings.endpoint.transform]
type = "reverse_sigmoid"
low = 2
high = 5
k = 0.5

# ========================================
# 第五优先级：毒性过滤（精简版）
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.CustomAlerts]
[[stage.scoring.component.CustomAlerts.endpoint]]
name = "Toxicity_Alerts"
weight = 1.2

[stage.scoring.component.CustomAlerts.endpoint.params]
smarts = [
    "N=N",
    "[N;R0]=[N;R0][#6]",
    "C(=O)Cl",
    "[#6]OO[#6]",
    "C(=O)C(=O)",
    "[Cl,Br,I][#6][Cl,Br,I]",
]

[[stage.scoring.component]]
[stage.scoring.component.CustomAlerts]
[[stage.scoring.component.CustomAlerts.endpoint]]
name = "PAINS_Filter"
weight = 0.8

[stage.scoring.component.CustomAlerts.endpoint.params]
smarts = [
    "O=C1C=CC(=O)C=C1",
    "[OH]c1ccccc1[OH]",
    "c1ccc2c(c1)[nH]c1ccccc12",
]
