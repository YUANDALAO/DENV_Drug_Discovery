run_type = "staged_learning"
device = "cuda:0"
tb_logdir = "experiments/runs/run8_aggressive/tensorboard"
json_out_config = "experiments/runs/run8_aggressive/_config.json"

[parameters]
summary_csv_prefix = "experiments/runs/run8_aggressive/results"
use_checkpoint = false
purge_memories = false

prior_file = "priors/libinvent.prior"
agent_file = "priors/libinvent.prior"
smiles_file = "data/pyrrolidine_libinvent.smi"

batch_size = 128           # 从64增加到128 - 更大批次
unique_sequences = true
randomize_smiles = true    # 从false改为true - 增加多样性

[learning_strategy]
type = "dap"
sigma = 120
rate = 0.0001

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = 15           # 从25降低到15 - 更严格去重
minscore = 0.4             # 从0.5降低 - 给更多机会

[inception]
smiles_file = "data/pyrrolidine_libinvent.smi"
memory_size = 100          # 从50增加 - 更多记忆
sample_size = 10           # 从5增加 - 更多采样

[[stage]]
max_score = 0.80           # 从0.90降低 - 更容易达到，不过早终止
min_steps = 1000           # 从500增加
max_steps = 4000           # 从1500增加到4000 - 生成50万分子
chkpt_file = "experiments/runs/run8_aggressive/checkpoint.chkpt"

[stage.scoring]
type = "arithmetic_mean"

# ========================================
# 第一优先级：活性（提升权重和放宽约束）
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.QSARScorer]
[[stage.scoring.component.QSARScorer.endpoint]]
name = "DENV_Activity"
weight = 2.5               # 从1.5大幅提升到2.5
[stage.scoring.component.QSARScorer.endpoint.params]
model_path = "/mnt/c/Users/ucsaheu/python_projects/DENV_Drug_Discovery/02_ML_Modeling/models/random_forest_champion.joblib"
[stage.scoring.component.QSARScorer.endpoint.transform]
type = "double_sigmoid"
low = 4.0                  # 从5.0降低到4.0 - 接受更低起点
high = 9.0
coef_div = 9.0
coef_si = 8.0              # 从10.0降低 - 更平缓的曲线
coef_se = 8.0

# ========================================
# 第二优先级：化学稳定性（保持严格）
# ========================================

# 立体中心 - 适度放宽
[[stage.scoring.component]]
[stage.scoring.component.NumAtomStereoCenters]
[[stage.scoring.component.NumAtomStereoCenters.endpoint]]
name = "Stereo_Centers"
weight = 0.6               # 从1.0降低到0.6
[stage.scoring.component.NumAtomStereoCenters.endpoint.transform]
type = "reverse_sigmoid"
low = 0
high = 3                   # 从2放宽到3
k = 1.0                    # 从1.5降低 - 更平缓

# 不良结构 - 保持原样
[[stage.scoring.component]]
[stage.scoring.component.CustomAlerts]
[[stage.scoring.component.CustomAlerts.endpoint]]
name = "Stability_Alerts"
weight = 1.0
[stage.scoring.component.CustomAlerts.endpoint.params]
smarts = [
    # 基础不稳定结构
    "[*;r8]", "[*;r9]", "[*;r10]",
    "[#8][#8]",
    "[#6;+]",
    "C#C",
    "[NX3][NX3]",
    "[SH]",
    "C(=O)OC(=O)",
    "[N+](=O)[O-]",
    "S(=O)(=O)Cl",
    "[F,Cl,Br,I][C,c][F,Cl,Br,I]",
    "c1ccc2c(c1)C(=O)c1c(C2=O)cccc1",
    "C1=CC(=O)C=CC1=O",
    
    # 吡咯烷特定规则
    "[C;R1]1[C;R1][C;R1][N;R1][C;R1]1([!#1])([!#1])([!#1])",
    "[C;R1]1[C;R1]([!#1])([!#1])[C;R1]([!#1])([!#1])[N;R1][C;R1]1",
    "C(=O)N([!#1])C(=O)",
]

# ========================================
# 第三优先级：类药性（大幅放宽）
# ========================================

[[stage.scoring.component]]
[stage.scoring.component.Qed]
[[stage.scoring.component.Qed.endpoint]]
name = "QED"
weight = 0.3               # 从0.5降低到0.3

[[stage.scoring.component]]
[stage.scoring.component.SAScore]
[[stage.scoring.component.SAScore.endpoint]]
name = "SA"
weight = 0.4               # 从0.6降低到0.4
[stage.scoring.component.SAScore.endpoint.transform]
type = "reverse_sigmoid"
low = 1.0
high = 5.5                 # 从4.5放宽到5.5
k = 0.8                    # 从1.0降低

# ========================================
# 第四优先级：物理化学性质（适度放宽）
# ========================================

[[stage.scoring.component]]
[stage.scoring.component.MolecularWeight]
[[stage.scoring.component.MolecularWeight.endpoint]]
name = "MW"
weight = 0.3               # 从0.4降低
[stage.scoring.component.MolecularWeight.endpoint.transform]
type = "double_sigmoid"
low = 250.0                # 从300降低
high = 800.0               # 放宽到800 - 允许大分子
coef_div = 800.0
coef_si = 20.0
coef_se = 20.0

[[stage.scoring.component]]
[stage.scoring.component.NumHeavyAtoms]
[[stage.scoring.component.NumHeavyAtoms.endpoint]]
name = "Heavy_Atoms"
weight = 0.2               # 从0.3降低
[stage.scoring.component.NumHeavyAtoms.endpoint.transform]
type = "double_sigmoid"
low = 18                   # 从20降低
high = 40                  # 从35放宽
coef_div = 40.0
coef_si = 5.0
coef_se = 5.0

# LogP约束
[[stage.scoring.component]]
[stage.scoring.component.SlogP]
[[stage.scoring.component.SlogP.endpoint]]
name = "LogP"
weight = 0.3               # 从0.4降低
[stage.scoring.component.SlogP.endpoint.transform]
type = "double_sigmoid"
low = 0.5                  # 从1.0降低
high = 5.0                 # 从4.0放宽
coef_div = 5.0
coef_si = 10.0
coef_se = 10.0

# TPSA约束
[[stage.scoring.component]]
[stage.scoring.component.TPSA]
[[stage.scoring.component.TPSA.endpoint]]
name = "TPSA"
weight = 0.2               # 从0.3降低
[stage.scoring.component.TPSA.endpoint.transform]
type = "double_sigmoid"
low = 30.0                 # 从40降低
high = 120.0               # 从100放宽
coef_div = 120.0
coef_si = 20.0
coef_se = 20.0

# 氢键受体
[[stage.scoring.component]]
[stage.scoring.component.HBondAcceptors]
[[stage.scoring.component.HBondAcceptors.endpoint]]
name = "HBA"
weight = 0.3               # 从0.4降低
[stage.scoring.component.HBondAcceptors.endpoint.transform]
type = "reverse_sigmoid"
low = 2
high = 8                   # 从7放宽
k = 0.5

# 氢键供体
[[stage.scoring.component]]
[stage.scoring.component.HBondDonors]
[[stage.scoring.component.HBondDonors.endpoint]]
name = "HBD"
weight = 0.2               # 从0.3降低
[stage.scoring.component.HBondDonors.endpoint.transform]
type = "reverse_sigmoid"
low = 0
high = 4                   # 从3放宽
k = 0.5

# ========================================
# 第五优先级：结构复杂度（适度放宽）
# ========================================

[[stage.scoring.component]]
[stage.scoring.component.NumRotBond]
[[stage.scoring.component.NumRotBond.endpoint]]
name = "Rotatable_Bonds"
weight = 0.2               # 从0.3降低
[stage.scoring.component.NumRotBond.endpoint.transform]
type = "reverse_sigmoid"
low = 0
high = 9                   # 从7放宽
k = 0.5

[[stage.scoring.component]]
[stage.scoring.component.NumRings]
[[stage.scoring.component.NumRings.endpoint]]
name = "Ring_Count"
weight = 0.2               # 从0.3降低
[stage.scoring.component.NumRings.endpoint.transform]
type = "reverse_sigmoid"
low = 2
high = 5                   # 从4放宽
k = 0.5

[[stage.scoring.component]]
[stage.scoring.component.NumAromaticRings]
[[stage.scoring.component.NumAromaticRings.endpoint]]
name = "Aromatic_Rings"
weight = 0.15              # 从0.2降低
[stage.scoring.component.NumAromaticRings.endpoint.transform]
type = "reverse_sigmoid"
low = 1
high = 3
k = 0.5