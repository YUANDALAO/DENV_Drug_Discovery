# REINVENT4 Run4 - DENV抑制剂生成（GroupCount修正版）
run_type = "staged_learning"
device = "cuda:0"
tb_logdir = "experiments/runs/run4/tensorboard"
json_out_config = "experiments/runs/run4/_config_export.json"

[parameters]
summary_csv_prefix = "experiments/runs/run4/results"
use_checkpoint = false
purge_memories = false
prior_file = "priors/denv_ultra_clean_model.model"
agent_file = "priors/denv_ultra_clean_model.model"
batch_size = 64
unique_sequences = true
randomize_smiles = true

[learning_strategy]
type = "dap"
sigma = 120
rate = 0.0001

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = 25
minscore = 0.5
minsimilarity = 0.4

[inception]
smiles_file = "data/scaffold_seeds_correct.smi"
memory_size = 100
sample_size = 10

[[stage]]
max_score = 0.90
min_steps = 1000
max_steps = 2000
chkpt_file = "experiments/runs/run4/denv_run4_final.chkpt"

[stage.scoring]
type = "arithmetic_mean"

# ========================================
# 吡咯烷特征A: C(N)a (权重1.5)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.GroupCount]
[[stage.scoring.component.GroupCount.endpoint]]
name = "Pyrr_Feature_A"
weight = 1.5
[stage.scoring.component.GroupCount.endpoint.params]
smarts = "C(N)a"
[stage.scoring.component.GroupCount.endpoint.transform]
type = "step"
low = 1.0

# ========================================
# 吡咯烷特征B: 酰胺 (权重1.5)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.GroupCount]
[[stage.scoring.component.GroupCount.endpoint]]
name = "Pyrr_Feature_B"
weight = 1.5
[stage.scoring.component.GroupCount.endpoint.params]
smarts = "C(=O)N"
[stage.scoring.component.GroupCount.endpoint.transform]
type = "step"
low = 1.0

# ========================================
# 环丁烷特征A: 环C-芳香 (权重1.5)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.GroupCount]
[[stage.scoring.component.GroupCount.endpoint]]
name = "Cyclo_Feature_A"
weight = 1.5
[stage.scoring.component.GroupCount.endpoint.params]
smarts = "[C;R]a"
[stage.scoring.component.GroupCount.endpoint.transform]
type = "step"
low = 1.0

# ========================================
# 环丁烷特征B: 酰胺 (权重1.5)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.GroupCount]
[[stage.scoring.component.GroupCount.endpoint]]
name = "Cyclo_Feature_B"
weight = 1.5
[stage.scoring.component.GroupCount.endpoint.params]
smarts = "C(=O)N"
[stage.scoring.component.GroupCount.endpoint.transform]
type = "step"
low = 1.0

# ========================================
# QSAR活性预测 (权重1.5)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.QSARScorer]
[[stage.scoring.component.QSARScorer.endpoint]]
name = "DENV_Activity_pIC50"
weight = 1.5
[stage.scoring.component.QSARScorer.endpoint.params]
model_path = "/mnt/c/Users/ucsaheu/python_projects/DENV_Drug_Discovery/02_ML_Modeling/models/random_forest_champion.joblib"
[stage.scoring.component.QSARScorer.endpoint.transform]
type = "double_sigmoid"
low = 5.0
high = 9.0
coef_div = 9.0
coef_si = 10.0
coef_se = 10.0

# ========================================
# 类药性 (权重0.5)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.Qed]
[[stage.scoring.component.Qed.endpoint]]
name = "Drug_Likeness"
weight = 0.5

# ========================================
# 合成可及性 (权重0.4)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.SAScore]
[[stage.scoring.component.SAScore.endpoint]]
name = "Synthetic_Accessibility"
weight = 0.4
[stage.scoring.component.SAScore.endpoint.transform]
type = "reverse_sigmoid"
low = 1.0
high = 7.0
k = 1.0

# ========================================
# 分子量 (权重0.3)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.MolecularWeight]
[[stage.scoring.component.MolecularWeight.endpoint]]
name = "Molecular_Weight"
weight = 0.3
[stage.scoring.component.MolecularWeight.endpoint.transform]
type = "double_sigmoid"
low = 250.0
high = 800.0
coef_div = 800.0
coef_si = 20.0
coef_se = 20.0

# ========================================
# LogP (权重0.3)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.SlogP]
[[stage.scoring.component.SlogP.endpoint]]
name = "LogP"
weight = 0.3
[stage.scoring.component.SlogP.endpoint.transform]
type = "double_sigmoid"
low = 1.0
high = 5.0
coef_div = 5.0
coef_si = 20.0
coef_se = 20.0

# ========================================
# 氢键 (权重0.2)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.HBondDonors]
[[stage.scoring.component.HBondDonors.endpoint]]
name = "H_Bond_Donors"
weight = 0.2
[stage.scoring.component.HBondDonors.endpoint.transform]
type = "step"
high = 5.0

[[stage.scoring.component]]
[stage.scoring.component.HBondAcceptors]
[[stage.scoring.component.HBondAcceptors.endpoint]]
name = "H_Bond_Acceptors"
weight = 0.2
[stage.scoring.component.HBondAcceptors.endpoint.transform]
type = "step"
high = 10.0

# ========================================
# 不良结构过滤 (权重1.0)
# ========================================
[[stage.scoring.component]]
[stage.scoring.component.CustomAlerts]
[[stage.scoring.component.CustomAlerts.endpoint]]
name = "Unwanted_SMARTS"
weight = 1.0
[stage.scoring.component.CustomAlerts.endpoint.params]
smarts = [
    "[*;r8]", "[*;r9]", "[*;r10]", "[*;r11]", "[*;r12]",
    "[#8][#8]", "[#6;+]", "[#16][#16]", "C#C", "C(=[O,S])[O,S]",
    "[#7;!n][#7;!n]"
]
