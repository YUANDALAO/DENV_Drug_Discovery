# REINVENT4 Scaffold-Constrained RL - DENV抑制剂生成

run_type = "staged_learning"
device = "cuda:0"
tb_logdir = "tb_denv_scaffold_constrained"
json_out_config = "_scaffold_constrained.json"

[parameters]
summary_csv_prefix = "denv_scaffold_results"
use_checkpoint = false
purge_memories = false

prior_file = "priors/denv_ultra_clean_model.model"
agent_file = "priors/denv_ultra_clean_model.model"

batch_size = 64
unique_sequences = true
randomize_smiles = true

[learning_strategy]
type = "dap"
sigma = 120
rate = 0.0001

[diversity_filter]
type = "IdenticalMurckoScaffold"
bucket_size = 25
minscore = 0.4
minsimilarity = 0.4

[inception]
smiles_file = "data/denv_scaffolds_training.smi"
memory_size = 100
sample_size = 10

[[stage]]
max_score = 0.75
min_steps = 500
max_steps = 1500
chkpt_file = "denv_scaffold_constrained.chkpt"

[stage.scoring]
type = "geometric_mean"

# ============================================
# 组件1: 吡咯烷骨架匹配
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.MatchingSubstructure]

[[stage.scoring.component.MatchingSubstructure.endpoint]]
name = "Pyrrolidine_Scaffold"
weight = 0.4

[stage.scoring.component.MatchingSubstructure.endpoint.params]
smarts = "c1ccccc1C2CCNC2"
use_chirality = false

# ============================================
# 组件2: 环丁烷骨架匹配
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.MatchingSubstructure]

[[stage.scoring.component.MatchingSubstructure.endpoint]]
name = "Cyclobutane_Scaffold"
weight = 0.4

[stage.scoring.component.MatchingSubstructure.endpoint.params]
smarts = "c1ccccc1C1CCC1"
use_chirality = false

# ============================================
# 组件3: QSAR活性预测
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.QSARScorer]

[[stage.scoring.component.QSARScorer.endpoint]]
name = "DENV_Activity_pIC50"
weight = 0.5

[stage.scoring.component.QSARScorer.endpoint.params]
model_path = "/mnt/c/Users/ucsaheu/python_projects/DENV_Drug_Discovery/02_ML_Modeling/models/random_forest_champion.joblib"

[stage.scoring.component.QSARScorer.endpoint.transform]
type = "double_sigmoid"
low = 5.0
high = 8.0
coef_div = 8.0
coef_si = 10.0
coef_se = 10.0

# ============================================
# 组件4: 类药性
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.Qed]

[[stage.scoring.component.Qed.endpoint]]
name = "Drug_Likeness"
weight = 0.3

# ============================================
# 组件5: 合成可及性
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.SAScore]

[[stage.scoring.component.SAScore.endpoint]]
name = "Synthetic_Accessibility"
weight = 0.3

[stage.scoring.component.SAScore.endpoint.transform]
type = "reverse_sigmoid"
low = 1.0
high = 6.0
k = 1.0

# ============================================
# 组件6: 分子量
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.MolecularWeight]

[[stage.scoring.component.MolecularWeight.endpoint]]
name = "Molecular_Weight"
weight = 0.3

[stage.scoring.component.MolecularWeight.endpoint.transform]
type = "double_sigmoid"
low = 250.0
high = 450.0
coef_div = 450.0
coef_si = 20.0
coef_se = 20.0

# ============================================
# 组件7: LogP
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.SlogP]

[[stage.scoring.component.SlogP.endpoint]]
name = "LogP"
weight = 0.2

[stage.scoring.component.SlogP.endpoint.transform]
type = "double_sigmoid"
low = 1.0
high = 4.0
coef_div = 4.0
coef_si = 20.0
coef_se = 20.0

# ============================================
# 组件8: 不良结构过滤
# ============================================
[[stage.scoring.component]]

[stage.scoring.component.CustomAlerts]

[[stage.scoring.component.CustomAlerts.endpoint]]
name = "Unwanted_SMARTS"
weight = 0.5

[stage.scoring.component.CustomAlerts.endpoint.params]
smarts = [
    "[*;r8]",
    "[*;r9]",
    "[*;r10]",
    "[#8][#8]",
    "[#6;+]",
    "[#16][#16]",
    "C#C"
]
